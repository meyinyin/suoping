@{
    Maticsoft.BLL.About abll = new Maticsoft.BLL.About();
    var list = abll.GetModelList("ID=1");

}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>索平律师事务所</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <!-- Fav Icons -->
    <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">

    <!-- StyleSheets -->
    <link href="~/Content/sp3ui/css/slick.min.css" rel="stylesheet" />
    <link href="~/Content/sp3ui/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/sp3ui/css/magnific-popup.min.css" rel="stylesheet" />
    <link href="~/Content/sp3ui/css/font-awesome-5.15.1.min.css" rel="stylesheet" />

    <!-- Custom css File -->
    <link href="~/Content/sp3ui/css/style.css" rel="stylesheet" />
    <link href="~/Content/sp3ui/css/responsive.css" rel="stylesheet" />
    <!-- css -->


    <style type="text/css">
        .layerbgc::before {
            background: rgba(0, 0, 0, 0.45);
        }

        .footer-top {
            padding-top: 40px;
            padding-bottom: 0;
        }

        .footer-column {
            margin-bottom: 10px;
        }

        .footer-bottom {
            padding: 5px 0px;
        }

        body {
            position: relative;
        }

        .chat-wrapper {
            float: inherit;
            z-index: 9999 !important;
            font-size: 14px;
            color: #fff;
        }
        /*右侧按钮*/
        .chat-support-btn {
            position: fixed;
            display: inline-block;
            top: 70%;
            right: 0;
            margin-top: -70px;
            width: 120px;
            /*height: 40px;*/
            cursor: pointer;
        }

            .chat-support-btn img {
                position: absolute;
                border-radius: 50%;
            }
        /* 对话框*/
        .chat-main {
            position: fixed;
            display: none;
            right: 50px;
            bottom: 50px;
            width: 300px;
            height: 400px;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(0, 0, 0, .4);
        }

        /*对话框头部*/
        .chat-header {
            position: relative;
            padding: 10px;
            height: 80px;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            box-shadow: 0 0 5px rgba(0, 0, 0, .2);
            background-color: #cc3333;
        }

            .chat-header a:hover {
                cursor: pointer;
            }
        /*个人信息框*/
        .header-info-div {
            display: none;
            width: 290px;
            height: 150px;
            margin: -600px 0 0 -300px;
            border-radius: 4px;
            background-image: url(/Content/picture/flfw04.jpg);
        }

        .header-info-h2 {
            display: inline-block;
            margin: 15px 0 0 25px;
        }

        .header-info-span {
            position: absolute;
            top: 45px;
            left: -276px;
        }

        .chat-close {
            position: absolute;
            top: -15px;
            right: 5px;
            /* padding: 2px; */
            font-size: 40px;
            /* transform: rotate(90deg); */
            /* background-image:url(/Content/picture/icon_close.png); */
            cursor: pointer;
        }

        .chat-service-info {
            position: relative;
            top: 50%;
            margin-top: -20px;
            height: 40px;
        }

        .chat-service-img {
            display: inline-block;
            margin: 0 10px 0 20px;
            width: 40px;
            height: 40px;
            text-align: center;
            line-height: 40px;
            vertical-align: middle;
            color: #000;
            border-radius: 50%;
            box-shadow: 1px 1px 4px rgba(0, 0, 0, .2);
            background-image: url(/Content/picture/fwpz_2.png);
        }

        .chat-service-title {
            display: inline-block;
            vertical-align: middle;
        }

        .chat-service-detail {
            font-size: 12px;
        }

        /*对话框内容*/
        .chat-contain {
            overflow-y: auto;
            padding: 10px;
            height: 380px;
            word-wrap: break-word;
            background-color: #f9f9f9;
        }

        .chat-text {
            display: inline-block;
            position: relative;
            padding: 10px;
            max-width: 120px;
            color: black;
            white-space: pre-wrap;
            border: 1px solid #ffff7d;
            border-radius: 4px;
            background-color: #ffff7d;
            box-sizing: border-box;
        }

        .chat-time {
            color: #939393;
            font-size: 12px;
        }

        .chat-service-contain {
            margin-bottom: 10px;
            text-align: left;
        }

            .chat-service-contain .chat-time {
                margin: 0 0 0 37px;
            }

        .chat-address {
            display: inline-block;
            max-width: 100px;
            white-space: pre-wrap;
        }

        .chat-service-text {
            margin-left: 40px;
        }

            .chat-service-text:before {
                content: '';
                position: absolute;
                top: 50%;
                left: -48px;
                width: 35px;
                height: 36px;
                border: 1px solid transparent;
                background-image: url(/Content/picture/fwpz_2.png);
                border-radius: 50%;
                -webkit-transform: translate(0, -50%);
                transform: translate(0, -50%);
            }

        .chat-you-contain {
            /*margin-bottom: 10px;*/
            text-align: right;
            /* float:right; */
        }

            .chat-you-contain .chat-time {
                margin: 0 20px 0 0;
            }

        .chat-you-text {
            margin-right: 20px;
            text-align: left;
        }

            .chat-you-text:after {
                content: '';
                position: absolute;
                top: 50%;
                right: -10px;
                width: 0;
                height: 0;
                border-top: 6px solid transparent;
                border-bottom: 6px solid transparent;
                border-left: 10px solid #ffff7d;
                -webkit-transform: translate(0, -50%);
                transform: translate(0, -50%);
            }
        /*客服对话框底部与输入*/
        .chat-submit {
            position: relative;
            padding: 10px;
            height: 100px;
            color: #000;
            word-wrap: break-word;
            border-top: 1px solid #ddd;
            box-sizing: border-box;
            background-color: #f9f9f9;
        }

        /*空输入提示*/
        .chat-hint {
            display: none;
            position: absolute;
            top: -15px;
            left: 20px;
            padding: 2px;
            width: 140px;
            height: 18px;
            font-size: 12px;
            text-align: center;
            line-height: 18px;
            border: 1px solid #ddd;
            box-shadow: 1px 1px 4px rgba(0, 0, 0, .4);
            background-color: #fff;
        }

        .chat-hint-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            margin-right: 5px;
            font-size: 14px;
            font-style: italic;
            font-weight: 700;
            vertical-align: middle;
            line-height: 18px;
            color: #fff;
            border-radius: 50%;
            background-color: #5d94f3
        }

        .chat-hint-text {
            display: inline-block;
            vertical-align: middle;
        }

        /*输入框*/
        .chat-input-text {
            overflow-y: auto;
            display: inline-block;
            padding: 5px 10px;
            width: 100%;
            height: 70px;
            vertical-align: middle;
            white-space: pre-wrap;
            word-wrap: break-word;
            resize: none;
            box-sizing: border-box;
        }

        .chat-input-tools {
            flex: auto;
            position: absolute;
            width: 100%;
            height: 30px;
            margin: -18px 0 0 200px;
            vertical-align: middle;
        }

        button {
            width: 20%;
            height: 28px;
            border-radius: 4px;
            background-color: #cc3333;
            margin: 5px 0;
        }

        .chat-input-tools > button:hover {
            cursor: pointer;
        }

        .simulator-text {
            display: inline-block;
            width: 200px;
            height: 260px;
            overflow-y: auto;
            padding: 10px 10px;
            vertical-align: middle;
            color: #000;
            white-space: pre-wrap;
            word-wrap: break-word;
            resize: none;
            box-sizing: border-box;
        }

        .chat-simulator {
            display: none;
            position: absolute;
            left: -230px;
            top: 200px;
            width: 200px;
            height: 300px;
            border: 1px solid #cc3333;
            border-radius: 4px;
            background-color: #f9f9f9;
            box-shadow: 0 0 5px rgba(0, 0, 0, .4);
        }

        .simulator-btn {
            float: right;
            padding: 0 10px;
        }

        .fl_new {
            min-height: 500px !important;
            overflow: hidden !important;
        }

        .fixed_right {
            right: 5px !important
        }
    </style>
</head>
<script src="~/Content/jqimg/js/jquery.js"></script>
<script src="~/Content/jqimg/js/jquery.SuperSlide.2.1.1.js"></script>
<body>
    <!--导航条-->
    @*<div class="header" style="
                font-size: 19px;
                font-family: " 微软雅黑", Microsoft YaHei;">

            <div class="header_n clearfix">

                <div class="logo fl"><a href="/Home/Index"><img src="~/Content/picture/logo1.png" alt="logo" width="200" height="57"></a></div>

                <ul class="fl clearfix">

                    <li><a href="/Home/Index" class="activeo clearline">首 页</a></li>

                    <li><a href="/Home/About" class="clearline">关于我们 </a></li>

                    <li><a href="/News/Index/?sort=2" class="clearline">法律咨询</a></li>

                    <li><a href="/News/Index/?sort=3" class="clearline">权威案例评析</a></li>

                    <li><a href="/News/Index/?sort=5" class="clearline">律师说法</a></li>

                    <li><a href="/Home/Contact" class="clearline">联系我们</a></li>

                </ul>

                <div class="tel fr">

                    <img src="~/Content/picture/tel.png" alt="tel" width="33" height="33">
                    @{ foreach (var m in list)
                        {
                            @m.Phone
                        }}

                </div>

            </div>

            <span class="line"></span>

        </div>*@
    <header>
        <!-- Navber -->
        <nav class="navbar navbar-expand-lg navbar-light main-nav" style="background:#382f34 ;">
            <div class="container">
                <a class="navbar-brand" href="/Home/Index">
                    <div class="logo">
                        <img src="~/Content/picture/logo1.png" class="w-100" alt="" />
                    </div>
                </a>

                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ml-auto navbar-custom">
                        <li class="nav-item active">
                            <a class="nav-link" href="/Home/Index">首页 </a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link" href="/Home/Index#suopingdongtai">索平动态</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="javascript:;" data-toggle="dropdown">关于索平</a>
                            <ul class="dropdown-menu">
                                <li><a class="nav-link" href="/Home/Index#suopingdongtai">律所介绍</a></li>
                                <li><a class="nav-link" href="/Home/Index#suopingdongtai">业务范围</a></li>
                                <li><a class="nav-link" href="/Home/Index#suopingdongtai">索平新闻</a></li>
                            </ul>
                        </li>

                        <li class="nav-item ">
                            <a class="nav-link " href="/Home/Index#suopingrongyu">索平荣誉</a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link " href="/News/Index/?sort=9"> 索平党建</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/Home/Contact"> 联系我们</a>
                        </li>
                    </ul>
                    <div class="" style="color:#fff">

                        <img src="~/Content/picture/tel.png" alt="tel" width="33" height="33">
                        @{ foreach (var m in list)
                            {
                                @m.Phone
                            }}
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div style="min-height:600px;">
        @RenderBody()
    </div>

    <!-- FOOTER TOP PART START -->
    <div class="footer-top">
        <div class="container">
            <div class="row justify-content-center justify-content-lg-between">
                <div class="col-xl-3 col-lg-5 col-md-6">
                    <div class="footer-column">
                        <div class="footer-logo">
                            <a href="javascript:;"><img src="~/Content/picture/logo1.png" alt="" /></a>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-4">
                    <p class="personal-info">
                        <i class="fas fa-phone-alt"></i>
                        <span>
                            <a href="callto:+00856554863">
                                @foreach (var i in list)
                                {@i.Phone}
                            </a>
                        </span>
                    </p>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-4">
                    <p class="personal-info" style="">
                        <i class="fas fa-envelope"></i>
                        <span>
                            <a href="mailto:emailhere24@gmail.com">
                                @foreach (var i in list)
                                {@i.avg4}
                            </a>
                        </span>
                    </p>
                </div>

                <div class="col-xl-2 col-lg-3 col-md-4">
                    <div class="footer-column" style="width:40%;">
                        <a href="javascript:;"><img src="@foreach (var i in list){@i.APicURL}" alt="" /></a>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- FOOTER TOP PART END -->
    <!-- FOOTER BOTTOM PART START -->
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-sm-7 text-center text-sm-left">
                    <div class="copy-right-text mb-sm-0 mb-2">
                        <p>陕ICP备2021009326</p>
                    </div>
                </div>
                <div class="col-sm-5 text-center text-sm-right">
                    <div class="copy-right-text">
                        <p>版权所有：陕西索平律师事务所</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- FOOTER BOTTOM PART END -->
    <!-- Preloader -->
    <div class="preloader"></div>




    <!--底部-->
    @*@{
            foreach (var n in list)
            {
                <div class="footer nopre">

                    <div class="footer_o clearfix">

                        <div class="footer_o_o fl">

                            <img src="~/Content/picture/logo1.png" alt="logo" width="200" height="57">

                        </div>

                        <div class="footer_o_t fl">

                            <p>全国热线</p>

                            <span>@n.Phone</span>

                        </div>

                        <div class="footer_o_t footer_o_s fl">

                            <p>商务合作</p>

                            <span>@n.avg4</span>

                        </div>
                        <a href="/News/Index/?sort=10">
                            <div class="footer_o_t footer_o_s fl">

                                <p>招聘信息</p>

                                <span>点击查看</span>

                            </div>
                        </a>
                        <div class="footer_o_f fr">

                            <img src="@n.APicURL" alt="ewm" width="140">

                        </div>

                    </div>

                    <div class="footer_t">

                        网站备案：陕ICP备2021009326 版权所有：陕西索平律师事务所

                    </div>

                </div>

            }
        }*@

    <!--底部-->
    <!--聊天室-->
    <div class="chat-wrapper" style="z-index:9999">
        <div id="btn_open" class="chat-support-btn" draggable="true">
            <!-- 聊天窗口缩小后的头像图标 -->
            <img src="~/Content/picture/10bb9bf94b245f9c1cfee692dad8003.png" width=""></img>
        </div>
        <div class="chat-main" draggable="true" style="z-index:9999">
            <div class='chat-simulator'>
                <p id="chat_hint" class="chat-hint"><span class="chat-hint-icon">!</span><span class="chat-hint-text" style='color:black'>发送内容不能为空</span></p>
                <textarea class='simulator-text' autofocus placeholder='请写下你希望我对你说的话,按enter键提交（shift+enter键换行）。'></textarea>
                <div class='simulator-btn'>
                    <button class='simulator-submmit'>提交</button>
                    @*<button class='simulator-close'>关闭</button>*@
                </div>
            </div>
            <div class="chat-header">
                <i id="btn_close" class="chat-close"><img src="~/Content/picture/cuo.png"></i>
                <div class="chat-service-info">
                    <a class="chat-service-img"></a>
                    <div class="chat-service-title">
                        <p class="chat-service-name">客服1</p>
                        <p class="chat-service-detail">我是您的专属客服</p>
                    </div>
                </div>
            </div>
            <div id="chat_contain" class="chat-contain">
                <!-- <p class="chat-service-contain">
                                <span class="chat-text chat-service-text">您好</span>
                            </p> -->
            </div>
            <div class="chat-submit">
                <p id='chatHint' class="chat-hint"><span class="chat-hint-icon">!</span><span class="chat-hint-text">发送内容不能为空</span></p>
                <textarea id="chat_input" class="chat-input-text" autofocus placeholder="请输入您想对我说的话，按Enter键发送（shift+Enter换行）。"></textarea>
                <div class="chat-input-tools">
                    <button class="chat-input-button">发送</button>
                    @*<button class="chat-service-simulator">模拟</button>*@
                    @*<button class="chat-close-button">关闭</button>*@
                </div>
            </div>
            <div class="header-info-div">
                <h2 class="header-info-h2">客服1</h2>
                <span class="header-info-span">我是您的专属客服</span>
            </div>
        </div>
    </div>


    <!--聊天室结束-->
    <!-- Javascript File -->
    @*<script src="~/Content/jqimg/js/jquery.js"></script>*@

    <script src="~/Content/sp3ui/js/jquery-3.6.0.min.js"></script>
    <script src="~/Content/sp3ui/js/bootstrap.min.js"></script>
    <script src="~/Content/sp3ui/js/slick.min.js"></script>
    <script src="~/Content/sp3ui/js/jquery.waypoints.min.js"></script>
    <script src="~/Content/sp3ui/js/jquery.counterup.min.js"></script>
    <script src="~/Content/sp3ui/js/jquery.magnific-popup.min.js"></script>
    <script src="~/Content/sp3ui/js/main.js"></script>
    <script type="text/javascript" src="~/Content/Gmile/axios.js"></script>
    <script type="text/javascript" src="~/Content/Gmile/store.js"></script>
    <script type="text/javascript" src="~/Content/Gmile/goeasy.js"></script>
    <script type="text/javascript" src="~/Content/Gmile/goeasyHanele.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vant@2.12/lib/vant.min.js"></script>
    <script src="~/static/admin/js/fingerprintjs.js"></script>
    <script src="~/Content/jqimg/js/jquery.SuperSlide.2.1.1.js"></script>
    <script>
        //锚点定位
        //var maodian = document.getElementById(navbarSupportedContent);
        //console.log(maodian)
        //var url = window.location.href;
        //var id = url.substring(url.lastIndexOf("#") + 1);
        //console.log(id);
        //console.log(url);
        //document.getElementById(id).scrollIntoView(true);

        ////或用jquery实现平滑过渡

        //$("html body").animate({ scrollTop: id }, 3000); //1秒内完成
    </script>
    @*<script type="text/javascript">
            setTimeout(() => {
                $(".home-banner-slider").slide({
                    mainCell: ".bd ul",
                    effect: "left",
                    autoPlay: false,
                    delayTime: 700
                });
                console.log($(".home-banner-slider").slide)
            },5000)

        </script>*@
    <script type="text/javascript">
        var d = document;
        let userChannel = ''
        let msgList = []
        let serverLogon = false
        let allMsgList = []
        let isFrist = true

        async function getChannel(){
            userChannel = await setChannel()

        }
        getChannel()

        function creatTalkAboutMessageList(msgList, userChannel) {
            msgList.forEach(it => {
                let GState = it.GState //判断是否为服务端
                let time = GetDate(it.GDate)
                if (!GState) {
                    createInfo('you', it.GContent, time);
                } else {
                    createInfo('service', it.GContent, time);
                }
            })
        }

        /*显示对话窗口*/
        async function openBody(msgList) {
            let toast = vant.Toast.loading({
                message: '获取历史记录',
                forbidClick: true,
                loadingType: 'spinner',
                duration: 0
            });
            msgList = await getMsglist()
            creatTalkAboutMessageList(msgList, userChannel)
            vant.Toast.clear();


           function msgCb(messageInfo) {
                let code = messageInfo.code
               if (code === 'serverLogon') {
                   serverLogon = true
                   setTimeout(() => {
                       serverLogon = false
                   },800)
               }
               if (code === 'severMsg') {
                   console.log(messageInfo)
                   let myUserID = getLocalSt('userChannel')
                   if (messageInfo.userID === myUserID) {
                       let msgContent = messageInfo.msgContent
                       let time = GetDate(`/Date(${messageInfo.time})/`)
                       createInfo('service', msgContent, time);
                   }
               }
               if (code === 'hasUser') {
                   let channel = getLocalSt('userChannel')
                   let msgInfo = {
                       code: 'userLogin',
                       ip: channel
                   }
                   msgInfo = JSON.stringify(msgInfo)
                   publish(msgInfo, 'SUOPINGALLMSGCHANNEL')
               }
            }
            createdGoEasy(msgCb)
            receiveImMsg('SUOPINGALLMSGCHANNEL', msgCb)

          @{
                Session["Chat"] = true;
          }
            $('.chat-support-btn').css({ 'display': 'none' });
            $('.chat-main').css({ 'display': 'inline-block', 'height': '0' });
            let url = window.location.href
            if (url.includes('/Home/Contact')) {
                $('.chat-main').animate({ 'height': '562px' })
            } else {
                $('.chat-main').animate({ 'height': '600px' })
            }
        }
            @if((bool)Session["Chat"] == true)
            {
                @*<script>openBody();</script>*@
            }


        // 模拟一些后端传输数据
        var serviceData = {
            'robot': {
                'chat': ['这个厉害！', '这个网站您看一下www.baidu.com', '稍等哦~', '嘿嘿', '百度一下？www.baidu.com', '嗯嗯嗯'],
            }
        };
        var chatMain = $('.chat-main'),
            chatHint = $('#chatHint'),
            chat_Hint = $('#chat_hint'),
            headerInfoDiv = $('.header-info-div');
            chat_main = d.querySelector('.chat-main');
            chatInput = d.querySelector('#chat_input'),
            chatContain = d.querySelector('#chat_contain'),
            btnOpen = d.querySelector('#btn_open'),
            btnClose = d.querySelector('#btn_close');

            /*鼠标在头像上*/
            $('.chat-service-img').mouseenter(
                function () {
                    headerInfoDiv.fadeIn(1000);
                }
            )
            $('.chat-service-img').mouseleave(
                function () {
                    headerInfoDiv.fadeOut();
                }
            )
            /*关闭对话框*/
        function closeChat() {
                clearMsgList()
                $('.chat-main').animate({ 'height': '0' });
                $('.chat-main').css({ 'display': 'none' });
                $('.chat-support-btn').css({ 'display': 'inline-block' });
                disconnectGoEasy()
            }

            btnOpen.addEventListener('click',async function (e) {/*点击头像打开聊天窗口*/
                e = e || window.event;
                openBody();
            })

            btnClose.addEventListener('click', closeChat)

        /*创建新消息框*/
        function createInfo(name, value,time) {
            var chatTime = new Date();
            chatTime = chatTime.toLocaleTimeString();
            var nodeP = d.createElement('p'),
                nodeSpan = d.createElement('span')
            nodeTime = d.createElement('p');
            value = value.replace(/(((ht|f)tps?):\/\/)?([A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@@[\]\':+!]*([^<>\"\"])*)/g,
                function (content) {
                return "<a href='http://" + content + "' class='chat-address' target='view_window' style='color:#6666cc '>" + content + '</a>';;
            });
            nodeP.classList.add('chat-' + name + '-contain');
            nodeSpan.classList.add('chat-' + name + '-text', 'chat-text');
            nodeTime.classList.add('chat-time');
            nodeSpan.innerHTML = value;
            nodeTime.innerHTML = time === null ? 'time_' : time;
            nodeP.appendChild(nodeTime);
            nodeP.appendChild(nodeSpan);
            chatContain.appendChild(nodeP);
            chatContain.scrollTop = chatContain.scrollHeight;
        }


        var timer,
            timerId,
            flagInput = false;
        shiftDown = false;  // 判断是否按住shift键

        function chatHintNull(chatHint) {//空输入提示
            setTimeout(function () {
                chatHint.fadeIn();
                clearTimeout(timerId);
                timer = setTimeout(function () {
                    chatHint.fadeOut();
                }, 1000);
            }, 10);
            timerId = timer;
        };
        /*监控是否按下enter*/
        function isEnter(Input, Hint, type, e) {
            e = e || window.event;
            if (e.keyCode == 16) {//按住shift键
                shiftDown = true;
            }
            if (e.keyCode == 13) {

                if (shiftDown == true) {
                    shiftDown = false;
                    return true;
                }
                else if (shiftDown == false && Input.value == '') {
                    Hint();
                    return true;
                }
                else {
                    e.preventDefault();
                    //createInfo(type, Input.value);
                    //submityouText(Input.value);
                    //Input.value = null;
                    //Input.focus();
                    isSendMsg()
                }
            }
        }

        chatInput.addEventListener('keydown', function (e) {/*输入框按enter*/
            e = e || window.event;
            isEnter(chatInput, chatHintNull, 'you', e);
        })

        async function isSendMsg() {
            var chatTime = new Date();
            chatTime = chatTime.toLocaleTimeString();
            //chatTime = GetDate(`/Date(${chatTime})/`)
            let res = await sendMsg(chatInput.value)
            if (res.isOK) {
                let channel = getLocalSt('userChannel')
                let msgInfo = {
                    code: 'userLogin',
                    ip: channel
                }
                msgInfo = JSON.stringify(msgInfo)
                publish(msgInfo,'SUOPINGALLMSGCHANNEL')


                let contentInfo = {
                    code: 'userMsg',
                    content: chatInput.value,
                    time: new Date().getTime(),
                    channel
                }
                contentInfo = JSON.stringify(contentInfo)
                publish(contentInfo, 'SUOPINGALLMSGCHANNEL')

                createInfo('you', chatInput.value,chatTime);
                chatInput.value = null;
                chatInput.focus();
                setTimeout(() => {
                    if (!serverLogon) {
                        submityouText(chatInput.value);
                    }
                },800)
            }
        }

        /*为按钮绑定事件*/
        $('.chat-input-button').click(async function () {/*消息框发送*/

            if (chatInput.value != '') {
                isSendMsg()
            }
            else {
                chatHintNull(chatHint);
            }
        });
        /*模拟后台消息*/
        var chatSim = $('.chat-simulator'),
            sim_Text = d.querySelector('.simulator-text');
        simText = $('.simulator-text');
        $('.chat-service-simulator').click(
            function () {
                chatSim.fadeIn(500);
                simText.focus();
            }
        );
        $('.simulator-submmit').click(function () {
            if (simText.val() == '') {
                chatHintNull(chat_Hint);
            }
            else {
                createInfo('service', simText.val());
                simText.val('');
                simText.focus();
            }
        });
        /*模拟的输入框enter键判断*/
        sim_Text.addEventListener('keydown', function (e) {
            e = e || window.event;
            isEnter(sim_Text, chatHintNull, 'service', e);
        })
        $('.simulator-close').click(function () {
            chatSim.fadeOut();
            simText.val('');
            simText.focus();
        });

        /*关闭按钮*/
        $('.chat-close-button').click(
            function () {
                if (confirm("不再聊会儿吗？")) {
                    window.close();
                }
                else { }
            }
        );
        /*按钮特效*/
        var buttons = $('button');
        buttons.each(function (i) {
            $(this).mouseenter(function () {
                buttons.eq(i).fadeTo('slow', 0.8);
            });
        }
        )
        buttons.each(function (i) {
            $(this).mouseleave(function () {
                buttons.eq(i).fadeTo('slow', 1);
            });
        }
        )

        function submityouText(text) {

            // 模拟后端回复
            //var num = Math.random() * 10;
            //if (num <= 7) {
            //    getServiceText(serviceData);
            //}
            var chatTime = new Date();
            chatTime = chatTime.toLocaleTimeString();
            createInfo('service', '客服未在线，请稍后再试',chatTime);
        }

        //function getServiceText(data) {/*已定义后台消息框*/
        //    var serviceText = data.robot.chat,
        //        i = Math.floor(Math.random() * serviceText.length);
        //    createInfo('service', serviceText[i]);
        //}
    </script>


</body>

@RenderSection("scripts", required: false)
</html>