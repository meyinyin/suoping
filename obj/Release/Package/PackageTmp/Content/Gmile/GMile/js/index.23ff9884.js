(function(e){function t(t){for(var i,r,o=t[0],c=t[1],l=t[2],d=0,m=[];d<o.length;d++)r=o[d],s[r]&&m.push(s[r][0]),s[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(m.length)m.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,o=1;o<n.length;o++){var c=n[o];0!==s[c]&&(i=!1)}i&&(a.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},s={index:0},a=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("c31f")},"04f4":function(e,t,n){"use strict";var i=n("26f7"),s=n.n(i);s.a},"08dd":function(e,t,n){},"0af2":function(e,t,n){},"0e156":function(e,t,n){"use strict";var i=n("9768"),s=n.n(i);s.a},1021:function(e,t,n){},"107a":function(e,t,n){},"15cf":function(e,t,n){},1663:function(e,t,n){"use strict";var i=n("e86c"),s=n.n(i);s.a},"1e45":function(e,t,n){"use strict";var i=n("83d7"),s=n.n(i);s.a},"26f7":function(e,t,n){},3423:function(e,t,n){"use strict";var i=n("107a"),s=n.n(i);s.a},"428f":function(e,t,n){},"436f":function(e,t,n){"use strict";var i=n("0af2"),s=n.n(i);s.a},"476d":function(e,t,n){"use strict";var i=n("428f"),s=n.n(i);s.a},"49c2":function(e,t,n){"use strict";var i=n("acce"),s=n.n(i);s.a},"4d21":function(e,t,n){"use strict";var i=n("917b"),s=n.n(i);s.a},"6a2b":function(e,t,n){},"6da9":function(e,t,n){},"6fc8":function(e,t,n){"use strict";var i=n("e78c"),s=n.n(i);s.a},7802:function(e,t,n){},"820e":function(e,t,n){},"83d7":function(e,t,n){},"909e":function(e,t,n){"use strict";var i=n("1021"),s=n.n(i);s.a},"917b":function(e,t,n){},9224:function(e){e.exports={name:"lemon-imui",version:"1.7.2",main:"dist/index.umd.min.js",description:"基于 VUE2.0 的 IM 聊天组件",homepage:"http://june000.gitee.io/lemon-im/",keywords:["vue","im","chat","vueim","vuechat","webim","webchat"],repository:{type:"git",url:"git+https://github.com/fanjyy/lemon-imui.git"},scripts:{serve:"vue-cli-service serve",build:"vue-cli-service build --target lib --name index packages/index.js","build-examples":"vue-cli-service build --dest examples/dist examples/main.js",lint:"eslint --fix --ext .js,.vue src"},dependencies:{axios:"^0.21.1","element-ui":"^2.15.1",goeasy:"^1.2.1",vue:"^2.6.10","vue-axios":"^3.2.4"},devDependencies:{"@vue/cli-plugin-babel":"^3.6.0","@vue/cli-plugin-eslint":"^3.6.0","@vue/cli-service":"^3.6.0","@vue/eslint-config-prettier":"^4.0.1","babel-eslint":"^10.0.2",eslint:"^5.16.0","eslint-plugin-vue":"^5.2.3",stylus:"^0.54.5","stylus-loader":"^3.0.2","vue-template-compiler":"^2.5.21"},author:"fanjun",license:"MIT"}},9768:function(e,t,n){},9800:function(e,t,n){},"9b01":function(e,t,n){"use strict";var i=n("6da9"),s=n.n(i);s.a},"9c9b":function(e,t,n){"use strict";var i=n("9800"),s=n.n(i);s.a},a215:function(e,t,n){},acce:function(e,t,n){},c31f:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var i=n("2b0e"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"imui-center"},[n("lemon-imui",{ref:"IMUI",attrs:{user:e.user,"hide-menu":e.hideMenu,"hide-menu-avatar":e.hideMenuAvatar,"hide-message-name":e.hideMessageName,"hide-message-time":e.hideMessageTime,"message-time-format":e.messageTimeFormat},on:{"change-contact":e.handleChangeContact,"pull-messages":e.handlePullMessages,"message-click":e.handleMessageClick,send:e.handleSend}})],1)])},a=[],r=(n("ac4d"),n("8a81"),n("ac6a"),n("28a5"),n("96cf"),n("3b8d")),o=(n("7f7f"),n("8e6e"),n("456d"),n("bd86")),c=n("2638"),l=n.n(c);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(n,!0).forEach(function(t){Object(o["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m,h,f,p,g={name:"lemonMessageVoice",inheritAttrs:!1,inject:["IMUI"],render:function(){var e=arguments[0];return e("lemon-message-basic",l()([{class:"lemon-message-voice"},{props:d({},this.$attrs)},{scopedSlots:{content:function(t){return e("span",[t.content," 🔈"])}}}]))}},v=g,b=(n("476d"),n("2877")),x=Object(b["a"])(v,m,h,!1,null,null,null),y=x.exports,w={id:1e3,avatar:"https://p.qqan.com/up/2018-4/15244505348390471.jpg",displayName:"野火。"},C=[{id:1,displayName:"像梦一样自由",avatar:"https://p.qqan.com/up/2020-2/2020022821001845128.jpg",index:"X",unread:0,lastSendTime:1566047865417,lastContent:"你开心吗"},{id:2,displayName:"梦醒时分、",avatar:"https://p.qqan.com/up/2021-1/20211301122243621.jpg",index:"M",unread:0,lastSendTime:1566047865417,lastContent:""},{id:3,displayName:"凌云",avatar:"https://p.qqan.com/up/2021-1/2021129102387841.jpg",index:"L",unread:0,lastSendTime:1566047865417,lastContent:""},{id:4,displayName:"小郭",avatar:"https://p.qqan.com/up/2021-1/2021122135507881.jpg",index:"X",unread:0,lastSendTime:1566047865417,lastContent:""},{id:5,displayName:"杨玉泉",avatar:"https://p.qqan.com/up/2021-1/20211211131598147.jpg",index:"Y",unread:0,lastSendTime:1566047865417,lastContent:""},{id:6,displayName:"森系Style",avatar:"https://p.qqan.com/up/2021-1/2021113104111220.jpg",index:"S",unread:0,lastSendTime:1566047865417,lastContent:""},{id:7,displayName:"霸王花",avatar:"https://p.qqan.com/up/2021-1/20211411391666.jpg",index:"B",unread:0,lastSendTime:1566047865417,lastContent:"你怎么还不睡呀？"},{id:8,displayName:"曾平",avatar:"https://p.qqan.com/up/2020-12/202012291044425822.jpg",index:"Z",unread:0,lastSendTime:1566047865417,lastContent:""},{id:9,displayName:"淡然",avatar:"https://p.qqan.com/up/2020-12/202012141813343503.jpg",index:"D",unread:0,lastSendTime:1566047865417,lastContent:""},{id:10,displayName:"叶子。",avatar:"https://p.qqan.com/up/2021-1/20211301122243621.jpg",index:"Y",unread:0,lastSendTime:1566047865417,lastContent:""},{id:11,displayName:"土豆",avatar:"https://p.qqan.com/up/2020-12/202012111157268739.jpg",index:"T",unread:0,lastSendTime:1566047865417,lastContent:""},{id:12,displayName:"清沫",avatar:"https://p.qqan.com/up/2020-12/202012415467996.jpg",index:"Q",unread:0,lastSendTime:1566047865417,lastContent:""},{id:13,displayName:"Lemon-imui交流群",avatar:"https://p.qqan.com/up/2020-11/20201127157109035.jpg",index:"L",isGroup:!0,unread:0,lastSendTime:1566047865417,lastContent:"这个咋处理啊？"},{id:14,displayName:"系统通知",avatar:"https://p.qqan.com/up/2020-6/2020061117234279854.jpg",index:"[1]系統通知",unread:0,lastSendTime:1566047865417,lastContent:"宁静致远通过了你的好友请求",renderContainer:function(){var e=this.$createElement;return e("div",{style:"padding:15px;"},[e("div",["宁静致远通过了你的好友请求"]),e("div",["宁静致远通过了你的好友请求"]),e("div",["宁静致远通过了你的好友请求"])])}},{id:15,displayName:"宁静致远。",avatar:"https://p.qqan.com/up/2020-6/2020060308522797777.jpg",index:"N",unread:0,lastSendTime:1566047865417,lastContent:""}],_=(n("7514"),n("6b54"),function(){return Math.random().toString(36).substr(-8)}),j=function(e){var t=C.find(function(t){return t.id==e});return{id:t.id,avatar:t.avatar,displayName:t.displayName}},I={1:[{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"问你件事",toContactId:1,fromUser:w},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"啥子。",toContactId:1,fromUser:j(1)},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"为什么",toContactId:1,fromUser:w},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"你穿了高跟鞋还这么矮",toContactId:1,fromUser:w},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"因为我矮啊。[!1f600][!1f600][!1f600]",toContactId:1,fromUser:j(1)},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"你开心吗",toContactId:1,fromUser:j(1)}],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[],11:[],12:[],13:[{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"我是测试时候看到的",toContactId:1,fromUser:j(4)},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"上新版本了，玩玩",toContactId:1,fromUser:j(4)},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"项目内没有搞这个",toContactId:1,fromUser:j(4)},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"@awesome 最新的，不然哪有这功能",toContactId:1,fromUser:j(5)},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"其实是跟你的遮罩层有冲突",toContactId:1,fromUser:j(4)},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"自己修改index哈",toContactId:1,fromUser:w},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"你们升级到最近版了吗？",toContactId:1,fromUser:j(6)},{id:_(),status:"succeed",type:"text",sendTime:1566047865417,content:"wo 现在用的142",toContactId:1,fromUser:j(7)}],14:[],15:[]},O=[{label:"表情",children:[{name:"1f600",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f600.png"},{name:"1f62c",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f62c.png"},{name:"1f601",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f601.png"},{name:"1f602",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f602.png"},{name:"1f923",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f923.png"},{name:"1f973",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f973.png"},{name:"1f603",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f603.png"},{name:"1f604",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f604.png"},{name:"1f605",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f605.png"},{name:"1f606",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f606.png"},{name:"1f607",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f607.png"},{name:"1f609",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f609.png"},{name:"1f60a",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f60a.png"},{name:"1f642",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f642.png"},{name:"1f643",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f643.png"},{name:"1263a",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/263a.png"},{name:"1f60b",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f60b.png"},{name:"1f60c",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f60c.png"},{name:"1f60d",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f60d.png"},{name:"1f970",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f970.png"},{name:"1f618",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f618.png"},{name:"1f617",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f617.png"},{name:"1f619",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f619.png"},{name:"1f61a",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f61a.png"},{name:"1f61c",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f61c.png"},{name:"1f92a",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f92a.png"},{name:"1f928",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f928.png"},{name:"1f9d0",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f9d0.png"},{name:"1f61d",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f61d.png"},{name:"1f61b",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f61b.png"},{name:"1f911",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f911.png"},{name:"1f913",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f913.png"},{name:"1f60e",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f60e.png"},{name:"1f929",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f929.png"},{name:"1f921",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f921.png"},{name:"1f920",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f920.png"},{name:"1f917",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f917.png"},{name:"1f60f",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f60f.png"},{name:"1f636",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f636.png"},{name:"1f610",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f610.png"},{name:"1f611",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f611.png"},{name:"1f612",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f612.png"},{name:"1f644",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f644.png"},{name:"1f914",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f914.png"},{name:"1f925",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f925.png"},{name:"1f92d",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f92d.png"},{name:"1f92b",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f92b.png"},{name:"1f92c",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f92c.png"},{name:"1f92f",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f92f.png"},{name:"1f633",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f633.png"},{name:"1f61e",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f61e.png"},{name:"1f61f",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f61f.png"},{name:"1f620",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f620.png"},{name:"1f621",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f621.png"}]},{label:"收藏",children:[{name:"1f62c",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f62c.png"},{name:"1f621",title:"微笑",src:"https://twemoji.maxcdn.com/2/72x72/1f621.png"}]}],S={name:"QqImui",components:{},data:function(){return{}},render:function(){var e=this,t=arguments[0];return t("div",{class:"qq-lemon-imui"},[t("lemon-imui",l()([{class:"lemon-slot",attrs:{user:w,width:900,"avatar-cricle":!0,"hide-message-name":!0,"hide-message-time":!0},ref:"IMUI"},{on:{"pull-messages":this.handlePullMessages,"change-contact":this.handleChangeContact,send:this.handleSend}},{scopedSlots:{"message-title":function(n){return t("div",[t("div",{style:"display:flex;justify-content:space-between"},[t("span",[n.displayName]),t("span",{style:"font-size:12px;"},[t("span",["打开抽屉："]),t("span",{class:"cursor:pointer;",on:{click:function(){return e.openDrawer("right")}}},["右侧 |"," "]),t("span",{class:"cursor:pointer;",on:{click:function(){return e.openDrawer("rightInside")}}},["右侧内部 |"," "]),t("span",{class:"cursor:pointer;",on:{click:function(){return e.openDrawer("center")}}},["居中"])])]),n.isGroup&&t("div",{class:"slot-group-menu"},[t("span",["聊天"]),t("span",["公告"]),t("span",["相册"]),t("span",["文件"]),t("span",["活动"]),t("span",{directives:[{name:"lemon-contextmenu",value:[{text:"操作一",click:function(e,t,n){n()}},{text:"操作二"}],modifiers:{click:!0}}]},["设置(左键弹出菜单)"])])])},"sidebar-contact-fixedtop":function(e){return t("div",{class:"slot-contact-fixedtop"},[t("input",{class:"slot-search",attrs:{placeholder:"搜索通讯录"}})])},"message-side":function(e){if(e.isGroup)return t("div",{class:"slot-group"},[t("div",{class:"slot-group-title"},["群通知"]),t("div",{class:"slot-group-notice"},["进群请改备注，格式，工作地点-姓名，请大家配合谢谢"]),t("div",{class:"slot-group-title"},["群成员"]),t("div",{class:"slot-group-panel"},[t("input",{class:"slot-search",attrs:{placeholder:"搜索群成员"}}),t("div",{class:"slot-group-member"},["河南-96-十里青山"]),t("div",{class:"slot-group-member"},["河南-96-十里青山"]),t("div",{class:"slot-group-member"},["河南-96-十里青山"]),t("div",{class:"slot-group-member"},["河南-96-十里青山"]),t("div",{class:"slot-group-member"},["河南-96-十里青山"]),t("div",{class:"slot-group-member"},["河南-96-十里青山"]),t("div",{class:"slot-group-member"},["河南-96-十里青山"]),t("div",{class:"slot-group-member"},["河南-96-十里青山"]),t("div",{class:"slot-group-member"},["河南-96-十里青山"]),t("div",{class:"slot-group-member"},["河南-96-十里青山"])])])}}}]))])},computed:{},watch:{},created:function(){},mounted:function(){var e=this.$refs.IMUI;e.initContacts(C),e.initEmoji(O),e.changeContact(13)},methods:{openDrawer:function(e){var t=this.$createElement,n=this.$refs.IMUI,i={position:e,render:function(e){return t("div",{style:"padding:15px"},[t("h5",[e.displayName]),t("span",{on:{click:n.closeDrawer}},["关闭抽屉"])])}};"center"==e?(i.width="50%",i.height="50%"):"rightInside"==e&&(i.height="90%",i.offsetY="10%"),n.openDrawer(i)},handlePullMessages:function(e,t){this.$refs.IMUI;setTimeout(function(){t(I[e.id],!0)},3e3)},handleChangeContact:function(){},handleSend:function(e,t,n){console.log(e,t,n),setTimeout(function(){t()},1e3)}}},M=S,k=(n("ce40"),Object(b["a"])(M,f,p,!1,null,null,null)),T=k.exports,$=n("9224"),D=n("bc3a"),L=n.n(D);i["default"].component(y.name,y),i["default"].component(T.name,T);var P={name:"app",data:function(){return{tip:"",packageData:$,hideMenuAvatar:!0,hideMenu:!1,hideMessageName:!1,hideMessageTime:!0,user:{id:"serveAdmain",displayName:"客服",avatar:""},api:{getmac:"gmile/getmac",msglist:"gmile/msglist",msgread:"gmile/msgread",getmsg:"gmile/getmsg",msgwd:"gmile/msgwd",msgread_:"gmile/msgread",addmsg:"gmile/addmsg"},touxiang:"http://upload.qqbodys.com/img/weixin/20170803/jiq4nzrkrnd0e.jpg",userList:[],curryInstance:{},curryMsgcontact:{},nextHandle:function(){}}},created:function(){var e=this;this.createdGoEasy();var t=function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(n){var i,s,a,r,o,c,l,u,d,m,h,f,p,g,v,b,x;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(i=e.$refs.IMUI,console.log(i),s=n.code,n.ip,a={},"userLogin"===s&&(r={code:"serverLogon"},r=JSON.stringify(r),e.publish(r,"SUOPINGALLMSGCHANNEL")),"userMsg"!==s){t.next=23;break}o=n.channel,c=!1,l=0,u=0;case 11:if(!(u<e.userList.length)){t.next=22;break}if(d=e.userList[u],m=d.id,o!==m){t.next=19;break}return c=!0,a=d,l=u,t.abrupt("break",22);case 19:u++,t.next=11;break;case 22:c?(h=n.time,f=n.content,p={},p.id=h,p.status="succeed",p.type="text",p.sendTime=h,p.content=f,p.toContactId=o,p.fromUser={id:o,displayName:"用户编号ID:".concat(o),avatar:e.touxiang},console.log(p),g=a.unread,o===e.curryMsgcontact.id?(v=e.userList[l].msgList,v.push(p),e.userList[l].msgList=v,i.appendMessage(p,!0)):e.$refs.IMUI.updateContact({id:o,unread:g+1})):(b={},b.FaceURL="",b.GChannel=e.user,b.GContent=n.content,b.GDate="/Date(".concat(n.time,")/"),b.GName="",b.GState=!1,b.ID=n.time,b.IP=n.channel,b.IsLock=!1,b.Level=null,b.MsgParentID=null,b.MsgSortID=null,b.MsgType=0,b.PicUrl="",b.RouteUrl="",b.TargetID=null,b.avg5="",b.isReady=!1,x={},x.otherInfo=b,x.id=b.IP,x.displayName="用户编号ID:".concat(b.IP),x.avatar=e.touxiang,x.unread=0,x.lastSendTime=1*b.GDate.split("(")[1].split(")")[0],x.lastContent=b.GContent,x.unread=1,x.msgList=[],console.log(x),e.userList.push(x),i.appendContact(x));case 23:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}();this.receiveImMsg("SUOPINGALLMSGCHANNEL",t)},mounted:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,n,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=document.querySelectorAll(".lemon-editor__tool")[0],t.style.height="20px",t.style.background="rgba(180,180,180,0.3)",n=document.querySelectorAll(".lemon-icon-folder")[0],n.style.display="none",i=this.$refs.IMUI,e.next=8,this.getUserLList();case 8:s=e.sent,i.initContacts(s);case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),methods:{sendMsg:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t,n){var i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i=this.user.id,e.next=3,this.requestGet(this.api.addmsg,{userip:n,serverip:i,content:t,isserver:!0});case 3:if(s=e.sent,!s.isOK){e.next=8;break}return e.abrupt("return",s);case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),requestGet:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n,i,s,a,r,o=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},i="https://192.168.2.22:44362/api/",s="".concat(i).concat(t),e.next=5,L()(s,{params:n});case 5:if(a=e.sent,r=a.data,200!==a.status){e.next=15;break}if(!r.IsSuccess){e.next=12;break}return e.abrupt("return",{isOK:!0,data:r.Data});case 12:return e.abrupt("return",{isOK:!1,data:r.Data});case 13:e.next=16;break;case 15:return e.abrupt("return",{isOK:!1,data:r.Data});case 16:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}(),getUserLList:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,n,i,s,a,r,o,c,l,u,d,m;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$loading({lock:!0,text:"正在加载联系人",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.next=3,this.requestGet(this.api.getmsg);case 3:if(n=e.sent,!n.isOK){e.next=50;break}i=[],s=!0,a=!1,r=void 0,e.prev=9,o=n.data[Symbol.iterator]();case 11:if(s=(c=o.next()).done){e.next=33;break}if(l=c.value,u=l.GState,u){e.next=30;break}return l.isReady=!1,d={},d.otherInfo=l,d.id=l.IP,d.displayName="用户编号ID:".concat(l.IP),d.avatar=this.touxiang,d.unread=0,d.lastSendTime=1*l.GDate.split("(")[1].split(")")[0],d.lastContent=l.GContent,e.next=26,this.requestGet(this.api.msgwd,{serverip:this.user.id});case 26:m=e.sent,m.isOK&&(d.unread=m.data),d.msgList=[],i.push(d);case 30:s=!0,e.next=11;break;case 33:e.next=39;break;case 35:e.prev=35,e.t0=e["catch"](9),a=!0,r=e.t0;case 39:e.prev=39,e.prev=40,s||null==o.return||o.return();case 42:if(e.prev=42,!a){e.next=45;break}throw r;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return this.userList=i,t.close(),e.abrupt("return",i);case 50:return t.close(),e.abrupt("return",[]);case 52:case"end":return e.stop()}},e,this,[[9,35,39,47],[40,,42,46]])}));function t(){return e.apply(this,arguments)}return t}(),messageTimeFormat:function(e){console.log(e)},handleMessageClick:function(e,t,n,i){console.log("点击了消息",e,t,n),"status"==t&&(i.updateMessage({id:n.id,status:"going",content:"正在重新发送消息..."}),setTimeout(function(){i.updateMessage({id:n.id,status:"succeed",content:"发送成功"})},2e3))},handleChangeContact:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.curryMsgcontact=t,this.curryInstance=n,this.curryInstance.updateContact({id:t.id,unread:0}),n.closeDrawer();case 4:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),handleSend:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t,n,i){var s,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,this.sendMsg(t.content,t.toContactId);case 3:s=e.sent,s.isOK&&(a={code:"severMsg",msgContent:t.content,time:t.sendTime,userID:t.toContactId},a=JSON.stringify(a),this.publish(a,"SUOPINGALLMSGCHANNEL"),setTimeout(function(){n()},1e3));case 5:case"end":return e.stop()}},e,this)}));function t(t,n,i){return e.apply(this,arguments)}return t}(),getMsg:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t,n){var i,s,a,r,o,c=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.requestGet(this.api.msglist,{serverip:this.user.id});case 2:if(i=e.sent,!i.isOK){e.next=18;break}this.$refs.IMUI,s=i.data.map(function(e){var t={};t.otherInfo=e,t.id=e.ID,t.status="succeed",t.type="text",t.sendTime=1*e.GDate.split("(")[1].split(")")[0],t.content=e.GContent;var n=e.GState;return n?(t.toContactId=e.IP,t.fromUser={id:c.user.id,displayName:c.user.displayName,avatar:c.touxiang}):(t.toContactId=c.user.id,t.fromUser={id:e.IP,displayName:"用户编号ID:".concat(e.IP),avatar:c.touxiang}),t}),a=n.id,r=0;case 8:if(!(r<this.userList.length-1)){e.next=16;break}if(o=this.userList[r],o.id!==a){e.next=13;break}return this.userList[r].msgList=s,e.abrupt("break",16);case 13:r++,e.next=8;break;case 16:return s.reverse(),e.abrupt("return",s);case 18:return e.abrupt("return",[]);case 19:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),handlePullMessages:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t,n,i){var s,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.nextHandle=n,this.requestGet(this.api.msgread_,{serverip:this.user.id}),t.otherInfo.isReady){e.next=10;break}return s=this.user.id,e.next=6,this.getMsg(s,t);case 6:a=e.sent,n(a,!0),e.next=10;break;case 10:case"end":return e.stop()}},e,this)}));function t(t,n,i){return e.apply(this,arguments)}return t}(),createdGoEasy:function(){this.goeasy.connect({userId:"serveAdmain",onSuccess:function(){console.log("GoEasy connect successfully.")},onFailed:function(e){console.log("Failed to connect GoEasy, code:"+e.code+",error:"+e.content)},onProgress:function(e){console.log("GoEasy is connecting",e)}})},receiveImMsg:function(e,t){this.goeasy.subscribe({channel:e,onMessage:function(e){var n=JSON.parse(e.content);t(n)},onSuccess:function(){console.log("Channel订阅成功。")},onFailed:function(e){console.log("Channel订阅失败, 错误编码："+e.code+" 错误信息："+e.content)}})},disconnectGoEasy:function(){this.goeasy.disconnect({onSuccess:function(){console.log("GoEasy disconnect successfully.")},onFailed:function(e){console.log("Failed to disconnect GoEasy, code:"+e.code+",error:"+e.content)}})},publish:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SUOPINGALLMSGCHANNEL";this.goeasy.publish({channel:t,message:e,onSuccess:function(){console.log("消息发布成功。")},onFailed:function(e){console.log("消息发送失败，错误编码："+e.code+" 错误信息："+e.content)}})}}},U=P,N=(n("9c9b"),n("6fc8"),Object(b["a"])(U,s,a,!1,null,null,null)),E=N.exports;n("3b2b"),n("8615");function R(e){return"[object Object]"===Object.prototype.toString.call(e)}function F(e){return"string"==typeof e}function q(e){return(new Date).getTime()-e<864e5}function A(e){return!e||(!(!Array.isArray(e)||0!=e.length)||!(!R(e)||0!=Object.values(e).length))}function B(e){return e&&"function"===typeof e}n("6762"),n("2fdb");var G,V,H,K=[],z={hover:function(e){},focus:function(e){var t=this;e.addEventListener("focus",function(e){t.changeVisible()}),e.addEventListener("blur",function(e){t.changeVisible()})},click:function(e){var t=this;e.addEventListener("click",function(e){e.stopPropagation(),ce.hide(),t.changeVisible()})},contextmenu:function(e){var t=this;e.addEventListener("contextmenu",function(e){e.preventDefault(),t.changeVisible()})}},Y={name:"LemonPopover",props:{trigger:{type:String,default:"click",validator:function(e){return Object.keys(z).includes(e)}}},data:function(){return{popoverStyle:{},visible:!1}},created:function(){document.addEventListener("click",this._documentClickEvent),K.push(this.close)},mounted:function(){z[this.trigger].call(this,this.$slots.default[0].elm)},render:function(){var e=arguments[0];return e("span",{style:"position:relative"},[e("transition",{attrs:{name:"lemon-slide-top"}},[this.visible&&e("div",{class:"lemon-popover",ref:"popover",style:this.popoverStyle,on:{click:function(e){return e.stopPropagation()}}},[e("div",{class:"lemon-popover__content"},[this.$slots.content]),e("div",{class:"lemon-popover__arrow"})])]),this.$slots.default])},destroyed:function(){document.removeEventListener("click",this._documentClickEvent)},computed:{},watch:{visible:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.$nextTick();case 3:n=this.$slots.default[0].elm,i=this.$refs.popover,this.popoverStyle={top:"-".concat(i.offsetHeight+10,"px"),left:"".concat(n.offsetWidth/2-i.offsetWidth/2,"px")};case 6:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},methods:{_documentClickEvent:function(e){e.stopPropagation(),this.visible&&this.close()},changeVisible:function(){this.visible?this.close():this.open()},open:function(){this.closeAll(),this.visible=!0},closeAll:function(){K.forEach(function(e){return e()})},close:function(){this.visible=!1}}},W=Y,J=(n("0e156"),Object(b["a"])(W,G,V,!1,null,null,null)),X=J.exports,Q=function(){H&&(H.style.display="none")},Z=function(){H&&(H.style.display="block")};document.addEventListener("click",function(e){Q()});var ee,te,ne,ie,se,ae,re,oe,ce={hide:Q,bind:function(e,t,n){e.addEventListener(t.modifiers.click?"click":"contextmenu",function(e){if(!A(t.value)&&Array.isArray(t.value)){var s;t.modifiers.click&&e.stopPropagation(),e.preventDefault(),X.methods.closeAll();var a=[];t.modifiers.message?s=n.context:t.modifiers.contact&&(s=n.child),H||(H=document.createElement("div"),H.className="lemon-contextmenu",document.body.appendChild(H)),H.innerHTML=t.value.map(function(e){var t;if(t=B(e.visible)?e.visible(s):void 0===e.visible||e.visible,t){a.push(e);var n=e.icon?'<i class="lemon-contextmenu__icon '.concat(e.icon,'"></i>'):"";return'<div style="color:'.concat(e.color,'" title="').concat(e.text,'" class="lemon-contextmenu__item">').concat(n,"<span>").concat(e.text,"</span></div>")}return""}).join(""),H.style.top="".concat(e.pageY,"px"),H.style.left="".concat(e.pageX,"px"),H.childNodes.forEach(function(e,t){var n=a[t],r=n.click,o=n.render;if(e.addEventListener("click",function(e){e.stopPropagation(),B(r)&&r(e,s,Q)}),B(o)){var c=i["default"].extend({render:function(e){return o(e,s,Q)}}),l=(new c).$mount();e.querySelector("span").innerHTML=l.$el.outerHTML}}),Z()}})}},le={name:"LemonTabs",props:{activeIndex:String},data:function(){return{active:this.activeIndex}},mounted:function(){this.active||(this.active=this.$slots["tab-pane"][0].data.attrs.index)},render:function(){var e=this,t=arguments[0],n=[],i=[];return this.$slots["tab-pane"].map(function(s){var a=s.data.attrs,r=a.tab,o=a.index;n.push(t("div",{class:"lemon-tabs-content__pane",directives:[{name:"show",value:e.active==o}]},[s])),i.push(t("div",{class:["lemon-tabs-nav__item",e.active==o&&"lemon-tabs-nav__item--active"],on:{click:function(){return e._handleNavClick(o)}}},[r]))}),t("div",{class:"lemon-tabs"},[t("div",{class:"lemon-tabs-content"},[n]),t("div",{class:"lemon-tabs-nav"},[i])])},methods:{_handleNavClick:function(e){this.active=e}}},ue=le,de=(n("3423"),Object(b["a"])(ue,ee,te,!1,null,null,null)),me=de.exports,he={name:"LemonButton",props:{color:{type:String,default:"default"},disabled:Boolean},render:function(){var e=arguments[0];return e("button",{class:["lemon-button","lemon-button--color-".concat(this.color)],attrs:{disabled:this.disabled,type:"button"},on:{click:this._handleClick}},[this.$slots.default])},methods:{_handleClick:function(e){this.$emit("click",e)}}},fe=he,pe=(n("1e45"),Object(b["a"])(fe,ne,ie,!1,null,null,null)),ge=pe.exports,ve=(n("c5f6"),{name:"LemonBadge",props:{count:[Number,Boolean],overflowCount:{type:Number,default:99}},render:function(){var e=arguments[0];return e("span",{class:"lemon-badge"},[this.$slots.default,0!==this.count&&void 0!==this.count&&e("span",{class:["lemon-badge__label",this.isDot&&"lemon-badge__label--dot"]},[this.label])])},computed:{isDot:function(){return!0===this.count},label:function(){return this.isDot?"":this.count>this.overflowCount?"".concat(this.overflowCount,"+"):this.count}},methods:{}}),be=ve,xe=(n("dbdc"),Object(b["a"])(be,se,ae,!1,null,null,null)),ye=xe.exports,we={name:"LemonAvatar",inject:["IMUI"],props:{src:String,icon:{type:String,default:"lemon-icon-people"},circle:{type:Boolean,default:function(){return!!this.IMUI&&this.IMUI.avatarCricle}},size:{type:Number,default:32}},data:function(){return{imageFinishLoad:!0}},render:function(){var e=this,t=arguments[0];return t("span",{style:this.style,class:["lemon-avatar",{"lemon-avatar--circle":this.circle}],on:{click:function(t){return e.$emit("click",t)}}},[this.imageFinishLoad&&t("i",{class:this.icon}),t("img",{attrs:{src:this.src},on:{load:this._handleLoad}})])},computed:{style:function(){var e="".concat(this.size,"px");return{width:e,height:e,lineHeight:e,fontSize:"".concat(this.size/2,"px")}}},methods:{_handleLoad:function(){this.imageFinishLoad=!1}}},Ce=we,_e=(n("04f4"),Object(b["a"])(Ce,re,oe,!1,null,null,null)),je=_e.exports;n("a481");function Ie(e,t,n){return e?e(n):t}function Oe(e){return e<10?"0".concat(e):e}function Se(e){var t,n=new Date(e),i=new Date,s=function(e){return e.getFullYear()},a=function(e){return"".concat(e.getMonth()+1,"-").concat(e.getDate())},r=s(n),o=s(i);return t=r!==o?"y年m月d日 h:i":"".concat(r,"-").concat(a(n))==="".concat(o,"-").concat(a(i))?"h:i":"m月d日 h:i",Me(e,t)}function Me(e,t){t||(t="y-m-d h:i:s"),e=e?new Date(e):new Date;for(var n=[e.getFullYear().toString(),Oe((e.getMonth()+1).toString()),Oe(e.getDate().toString()),Oe(e.getHours().toString()),Oe(e.getMinutes().toString()),Oe(e.getSeconds().toString())],i="ymdhis",s=0;s<n.length;s++)t=t.replace(i.charAt(s),n[s]);return t}function ke(e,t){B(e)?e(function(){t()}):t()}function Te(e){return e.replace(/<.*?>/gi,"")}function $e(e){return e.replace(/<(?!img).*?>/gi,"")}function De(e){if(null==e||""==e)return"0 Bytes";var t=["B","K","M","G","T","P","E","Z","Y"],n=0,i=parseFloat(e);n=Math.floor(Math.log(i)/Math.log(1024));var s=i/Math.pow(1024,n);return s=parseFloat(s.toFixed(2)),s+t[n]}function Le(){var e=(new Date).getTime();window.performance&&"function"===typeof window.performance.now&&(e+=performance.now());var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)});return t}var Pe,Ue,Ne={name:"LemonContact",components:{},inject:{IMUI:{from:"IMUI",default:function(){return this}}},data:function(){return{}},props:{contact:Object,simple:Boolean,timeFormat:{type:Function,default:function(e){return Me(e,q(e)?"h:i":"y/m/d")}}},render:function(){var e=this,t=arguments[0];return t("div",{class:["lemon-contact",{"lemon-contact--name-center":this.simple}],attrs:{title:this.contact.displayName},on:{click:function(t){return e._handleClick(t,e.contact)}}},[Ie(this.$scopedSlots.default,this._renderInner(),this.contact)])},created:function(){},mounted:function(){},computed:{},watch:{},methods:{_renderInner:function(){var e=this.$createElement,t=this.contact;return[e("lemon-badge",{attrs:{count:this.simple?0:t.unread},class:"lemon-contact__avatar"},[e("lemon-avatar",{attrs:{size:40,src:t.avatar}})]),e("div",{class:"lemon-contact__inner"},[e("p",{class:"lemon-contact__label"},[e("span",{class:"lemon-contact__name"},[t.displayName]),!this.simple&&e("span",{class:"lemon-contact__time"},[this.timeFormat(t.lastSendTime)])]),!this.simple&&e("p",{class:"lemon-contact__content"},[F(t.lastContent)?e("span",l()([{},{domProps:{innerHTML:t.lastContent}}])):t.lastContent])])]},_handleClick:function(e,t){this.$emit("click",t)}}},Ee=Ne,Re=(n("909e"),Object(b["a"])(Ee,Pe,Ue,!1,null,null,null)),Fe=Re.exports;n("5df3"),n("1c4c");function qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function Ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qe(n,!0).forEach(function(t){Object(o["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qe(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Be,Ge,Ve,He,Ke,ze,Ye,We=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"insertHTML";document.execCommand(t,!1,e)},Je=window.getSelection(),Xe=[],Qe={name:"LemonEditor",inject:{IMUI:{from:"IMUI",default:function(){return this}}},components:{},props:{tools:{type:Array,default:function(){return[]}},sendText:{type:String,default:"发 送"},sendKey:{type:Function,default:function(e){return 13==e.keyCode&&!0===e.ctrlKey}}},data:function(){return this.clipboardBlob=null,{clipboardUrl:"",submitDisabled:!0,proxyTools:[],accept:""}},created:function(){var e=this;this.tools&&this.tools.length>0?this.initTools(this.tools):this.initTools([{name:"emoji"},{name:"uploadFile"},{name:"uploadImage"}]),this.IMUI.$on("change-contact",function(){e.closeClipboardImage()})},render:function(){var e=this,t=arguments[0],n=[],i=[];return this.proxyTools.forEach(function(s){var a=s.name,r=s.title,o=s.render,c=s.click,l=s.isRight;c=c||new Function;var u,d=["lemon-editor__tool-item",{"lemon-editor__tool-item--right":l}];u="emoji"==a?0==Xe.length?"":t("lemon-popover",{class:"lemon-editor__emoji"},[t("template",{slot:"content"},[e._renderEmojiTabs()]),t("div",{class:d,attrs:{title:r}},[o()])]):t("div",{class:d,on:{click:c},attrs:{title:r}},[o()]),l?i.push(u):n.push(u)}),t("div",{class:"lemon-editor"},[this.clipboardUrl&&t("div",{class:"lemon-editor__clipboard-image"},[t("img",{attrs:{src:this.clipboardUrl}}),t("div",[t("lemon-button",{style:{marginRight:"10px"},on:{click:this.closeClipboardImage},attrs:{color:"grey"}},["取消"]),t("lemon-button",{on:{click:this.sendClipboardImage}},["发送图片"])])]),t("input",{style:"display:none",attrs:{type:"file",multiple:"multiple",accept:this.accept},ref:"fileInput",on:{change:this._handleChangeFile}}),t("div",{class:"lemon-editor__tool"},[t("div",{class:"lemon-editor__tool-left"},[n]),t("div",{class:"lemon-editor__tool-right"},[i])]),t("div",{class:"lemon-editor__inner"},[t("div",{class:"lemon-editor__input",ref:"textarea",attrs:{contenteditable:"true",spellcheck:"false"},on:{keyup:this._handleKeyup,keydown:this._handleKeydown,paste:this._handlePaste,click:this._handleClick}})]),t("div",{class:"lemon-editor__footer"},[t("div",{class:"lemon-editor__tip"},[Ie(this.IMUI.$scopedSlots["editor-footer"],"使用 ctrl + enter 快捷发送消息")]),t("div",{class:"lemon-editor__submit"},[t("lemon-button",{attrs:{disabled:this.submitDisabled},on:{click:this._handleSend}},[this.sendText])])])])},methods:{closeClipboardImage:function(){this.clipboardUrl="",this.clipboardBlob=null},sendClipboardImage:function(){this.clipboardBlob&&(this.$emit("upload",this.clipboardBlob),this.closeClipboardImage())},initTools:function(e){var t=this,n=this.$createElement;if(e){var i=[{name:"emoji",title:"表情",click:null,render:function(e){return n("i",{class:"lemon-icon-emoji"})}},{name:"uploadFile",title:"文件上传",click:function(){return t.selectFile("*")},render:function(e){return n("i",{class:"lemon-icon-folder"})}},{name:"uploadImage",title:"图片上传",click:function(){return t.selectFile("image/*")},render:function(e){return n("i",{class:"lemon-icon-image"})}}];if(Array.isArray(e)){var s={emoji:0,uploadFile:1,uploadImage:2},a=Object.keys(s);e.map(function(e){return a.includes(e.name)?Ae({},i[s[e.name]],{},e):e})}else i;this.proxyTools=[{name:"uploadFile",title:"文件上传",click:function(){},render:function(e){return n("i",{class:"lemon-icon-folder"})}}]}},_saveLastRange:function(){Be=Je.getRangeAt(0)},_focusLastRange:function(){this.$refs.textarea.focus(),Be&&(Je.removeAllRanges(),Je.addRange(Be))},_handleClick:function(){this._saveLastRange()},_renderEmojiTabs:function(){var e=this,t=this.$createElement,n=function(n){return n.map(function(n){return t("img",{attrs:{src:n.src,title:n.title},class:"lemon-editor__emoji-item",on:{click:function(){return e._handleSelectEmoji(n)}}})})};if(Xe[0].label){var i=Xe.map(function(e,i){return t("div",{slot:"tab-pane",attrs:{index:i,tab:e.label}},[n(e.children)])});return t("lemon-tabs",{style:"width: 412px"},[i])}return t("div",{class:"lemon-tabs-content",style:"width:406px"},[n(Xe)])},_handleSelectEmoji:function(e){this._focusLastRange(),We('<img emoji-name="'.concat(e.name,'" src="').concat(e.src,'"></img>')),this._checkSubmitDisabled(),this._saveLastRange()},selectFile:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.accept=t,e.next=3,this.$nextTick();case 3:this.$refs.fileInput.click();case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),_handlePaste:function(e){e.preventDefault();var t=e.clipboardData||window.clipboardData,n=t.getData("Text");if(n)window.clipboardData?this.$refs.textarea.innerHTML=n:We(n,"insertText");else{var i=this._getClipboardBlob(t),s=i.blob,a=i.blobUrl;this.clipboardBlob=s,this.clipboardUrl=a}},_getClipboardBlob:function(e){for(var t,n,i=0;i<e.items.length;++i)"file"==e.items[i].kind&&-1!==e.items[i].type.indexOf("image/")&&(t=e.items[i].getAsFile(),n=(window.URL||window.webkitURL).createObjectURL(t));return{blob:t,blobUrl:n}},_handleKeyup:function(e){this._saveLastRange(),this._checkSubmitDisabled()},_handleKeydown:function(e){0==this.submitDisabled&&this.sendKey(e)&&this._handleSend()},getFormatValue:function(){return this.IMUI.emojiImageToName(this.$refs.textarea.innerHTML)},_checkSubmitDisabled:function(){this.submitDisabled=!$e(this.$refs.textarea.innerHTML.trim())},_handleSend:function(e){var t=this.getFormatValue();this.$emit("send",t),this.clear(),this._checkSubmitDisabled()},_handleChangeFile:function(e){var t=this,n=this.$refs.fileInput;Array.from(n.files).forEach(function(e){t.$emit("upload",e)}),n.value=""},clear:function(){this.$refs.textarea.innerHTML=""},initEmoji:function(e){Xe=e,this.$forceUpdate()},setValue:function(e){this.$refs.textarea.innerHTML=this.IMUI.emojiNameToImage(e),this._checkSubmitDisabled()}}},Ze=Qe,et=(n("49c2"),Object(b["a"])(Ze,Ge,Ve,!1,null,null,null)),tt=et.exports,nt={name:"LemonMessages",components:{},props:{hideName:Boolean,hideTime:Boolean,reverseUserId:[String,Number],timeRange:{type:Number,default:1},timeFormat:{type:Function,default:function(e){return Se(e)}},loadingText:{type:[String,Function]},loadendText:{type:[String,Function],default:"暂无更多消息"},messages:{type:Array,default:function(){return[]}}},data:function(){return this._lockScroll=!1,{_loading:!1,_loadend:!1}},render:function(){var e=this,t=arguments[0];return t("div",{class:"lemon-messages",ref:"wrap",on:{scroll:this._handleScroll}},[t("div",{class:["lemon-messages__load","lemon-messages__load--".concat(this._loadend?"end":"ing")]},[t("span",{class:"lemon-messages__loadend"},[F(this.loadendText)?this.loadendText:this.loadendText()]),t("span",{class:"lemon-messages__loading"},[this.loadingText?F(this.loadingText)?this.loadingText:this.loadingText():t("i",{class:"lemon-icon-loading lemonani-spin"})])]),this.messages.map(function(n,i){var s,a=[],r="lemon-message-".concat(n.type),o=e.messages[i-1];return o&&e.msecRange&&n.sendTime-o.sendTime>e.msecRange&&a.push(t("lemon-message-event",l()([{},{attrs:{message:{id:"__time__",type:"event",content:Se(n.sendTime)}}}]))),s="event"==n.type?{message:n}:{timeFormat:e.timeFormat,message:n,reverse:e.reverseUserId==n.fromUser.id,hideTime:e.hideTime,hideName:e.hideName},a.push(t(r,l()([{ref:"message",refInFor:!0},{attrs:s}]))),a})])},computed:{msecRange:function(){return 1e3*this.timeRange*60}},watch:{},methods:{loaded:function(){this._loadend=!0,this.$forceUpdate()},resetLoadState:function(){var e=this;this._lockScroll=!0,this._loading=!1,this._loadend=!1,setTimeout(function(){e._lockScroll=!1},200)},_handleScroll:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n,i,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this._lockScroll){e.next=2;break}return e.abrupt("return");case 2:if(n=t.target,ce.hide(),0!=n.scrollTop||0!=this._loading||0!=this._loadend){e.next=10;break}return this._loading=!0,e.next=8,this.$nextTick();case 8:i=n.scrollHeight,this.$emit("reach-top",function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s.$nextTick();case 2:n.scrollTop=n.scrollHeight-i,s._loading=!1,s._loadend=!!t;case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),scrollToBottom:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$nextTick();case 2:t=this.$refs.wrap,t&&(t.scrollTop=t.scrollHeight);case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},created:function(){},mounted:function(){}},it=nt,st=(n("436f"),Object(b["a"])(it,He,Ke,!1,null,null,null)),at=st.exports,rt={name:"lemonMessageBasic",inject:{IMUI:{from:"IMUI",default:function(){return this}}},props:{contextmenu:Array,message:{type:Object,default:function(){return{}}},timeFormat:{type:Function,default:function(){return""}},reverse:Boolean,hideName:Boolean,hideTime:Boolean},data:function(){return{}},render:function(){var e=this,t=arguments[0],n=this.message,i=n.fromUser,s=n.status,a=n.sendTime,r=1==this.hideName&&1==this.hideTime;return t("div",{class:["lemon-message","lemon-message--status-".concat(s),{"lemon-message--reverse":this.reverse,"lemon-message--hide-title":r}]},[t("div",{class:"lemon-message__avatar"},[t("lemon-avatar",{attrs:{size:36,shape:"square",src:i.avatar},on:{click:function(t){e._emitClick(t,"avatar")}}})]),t("div",{class:"lemon-message__inner"},[t("div",{class:"lemon-message__title"},[0==this.hideName&&t("span",{on:{click:function(t){e._emitClick(t,"displayName")}}},[i.displayName]),0==this.hideTime&&t("span",{class:"lemon-message__time",on:{click:function(t){e._emitClick(t,"sendTime")}}},[this.timeFormat(a)])]),t("div",{class:"lemon-message__content-flex"},[t("div",{directives:[{name:"lemon-contextmenu",value:this.IMUI.contextmenu,modifiers:{message:!0}}],class:"lemon-message__content",on:{click:function(t){e._emitClick(t,"content")}}},[Ie(this.$scopedSlots["content"],null,this.message)]),t("div",{class:"lemon-message__content-after"},[Ie(this.IMUI.$scopedSlots["message-after"],null,this.message)]),t("div",{class:"lemon-message__status",on:{click:function(t){e._emitClick(t,"status")}}},[t("i",{class:"lemon-icon-loading lemonani-spin"}),t("i",{class:"lemon-icon-prompt",attrs:{title:"重发消息"},style:{color:"#ff2525",cursor:"pointer"}})])])])])},created:function(){},mounted:function(){},computed:{},watch:{},methods:{_emitClick:function(e,t){this.IMUI.$emit("message-click",e,t,this.message,this.IMUI)}}},ot=rt,ct=(n("fbd1"),Object(b["a"])(ot,ze,Ye,!1,null,null,null)),lt=ct.exports;function ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ut(n,!0).forEach(function(t){Object(o["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ut(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var mt,ht,ft={name:"lemonMessageText",inheritAttrs:!1,inject:["IMUI"],render:function(){var e=this,t=arguments[0];return t("lemon-message-basic",l()([{class:"lemon-message-text"},{props:dt({},this.$attrs)},{scopedSlots:{content:function(n){var i=e.IMUI.emojiNameToImage(n.content);return t("span",l()([{},{domProps:{innerHTML:i}}]))}}}]))}},pt=ft,gt=(n("1663"),Object(b["a"])(pt,mt,ht,!1,null,null,null)),vt=gt.exports;function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(n,!0).forEach(function(t){Object(o["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var yt,wt,Ct={name:"lemonMessageImage",inheritAttrs:!1,render:function(){var e=arguments[0];return e("lemon-message-basic",l()([{class:"lemon-message-image"},{props:xt({},this.$attrs)},{scopedSlots:{content:function(t){return e("img",{attrs:{src:t.content}})}}}]))}},_t=Ct,jt=(n("4d21"),Object(b["a"])(_t,yt,wt,!1,null,null,null)),It=jt.exports;function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function St(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(n,!0).forEach(function(t){Object(o["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Mt,kt,Tt,$t,Dt={name:"lemonMessageFile",inheritAttrs:!1,render:function(){var e=arguments[0];return e("lemon-message-basic",l()([{class:"lemon-message-file"},{props:St({},this.$attrs)},{scopedSlots:{content:function(t){return[e("div",{class:"lemon-message-file__inner"},[e("p",{class:"lemon-message-file__name"},[t.fileName]),e("p",{class:"lemon-message-file__byte"},[De(t.fileSize)])]),e("div",{class:"lemon-message-file__sfx"},[e("i",{class:"lemon-icon-attah"})])]}}}]))}},Lt=Dt,Pt=(n("cfab"),Object(b["a"])(Lt,Mt,kt,!1,null,null,null)),Ut=Pt.exports,Nt={name:"lemonMessageEvent",inheritAttrs:!1,inject:["IMUI"],render:function(){var e=this,t=arguments[0],n=this.$attrs.message.content;return t("div",{class:"lemon-message lemon-message-event"},[t("span",{class:"lemon-message-event__content",on:{click:function(t){return e._emitClick(t,"content")}}},[n])])},methods:{_emitClick:function(e,t){this.IMUI.$emit("message-click",e,t,this.$attrs.message,this.IMUI)}}},Et=Nt,Rt=(n("ed4b"),Object(b["a"])(Et,Tt,$t,!1,null,null,null)),Ft=Rt.exports,qt=(n("20d6"),n("75fc")),At=(n("f559"),n("55dd"),"messages"),Bt="contacts",Gt=[At,Bt],Vt={file:function(e){return"[文件]"},image:function(e){return"[图片]"},text:function(e){return this.emojiNameToImage(Te(e.content))},event:function(e){return"[通知]"}},Ht=n("d225"),Kt=n("b0b4"),zt=function(){function e(){Object(Ht["a"])(this,e),this.table={}}return Object(Kt["a"])(e,[{key:"get",value:function(e){return e?this.table[e]:this.table}},{key:"set",value:function(e,t){this.table[e]=t}},{key:"remove",value:function(e){e?delete this.table[e]:this.table={}}},{key:"has",value:function(e){return!!this.table[e]}}]),e}();function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function Wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yt(n,!0).forEach(function(t){Object(o["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Jt,Xt,Qt={},Zt={},en=function(e){return F(e)?e:"".concat(e,"px")},tn=function(e){return e.replace("%","")/100},nn=function(){},sn={name:"LemonImui",provide:function(){return{IMUI:this}},props:{width:{type:[String,Number],default:850},height:{type:[String,Number],default:580},theme:{type:String,default:"default"},simple:{type:Boolean,default:!1},loadingText:[String,Function],loadendText:[String,Function],messageTimeFormat:Function,contactTimeFormat:Function,hideDrawer:{type:Boolean,default:!0},hideMenuAvatar:Boolean,hideMenu:Boolean,hideMessageName:Boolean,hideMessageTime:Boolean,sendKey:Function,sendText:String,contextmenu:Array,contactContextmenu:Array,avatarCricle:Boolean,user:{type:Object,default:function(){return{}}}},data:function(){return this.CacheContactContainer=new zt,this.CacheMenuContainer=new zt,this.CacheMessageLoaded=new zt,this.CacheDraft=new zt,{drawerVisible:!this.hideDrawer,currentContactId:null,currentMessages:[],activeSidebar:At,contacts:[],menus:[],editorTools:[]}},render:function(){return this._renderWrapper([this._renderMenu(),this._renderSidebarMessage(),this._renderSidebarContact(),this._renderContainer(),this._renderDrawer()])},created:function(){this.initMenus()},mounted:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$nextTick();case 2:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),computed:{currentContact:function(){var e=this;return this.contacts.find(function(t){return t.id==e.currentContactId})||{}},currentMenu:function(){var e=this;return this.menus.find(function(t){return t.name==e.activeSidebar})||{}},currentIsDefSidebar:function(){return Gt.includes(this.activeSidebar)},lastMessages:function(){var e=this.contacts.filter(function(e){return!A(e.lastContent)});return e.sort(function(e,t){return t.lastSendTime-e.lastSendTime}),e}},watch:{activeSidebar:function(){}},methods:{_menuIsContacts:function(){return this.activeSidebar==Bt},_menuIsMessages:function(){return this.activeSidebar==At},_createMessage:function(e){return Wt({},{id:Le(),type:"text",status:"going",sendTime:(new Date).getTime(),toContactId:this.currentContactId,fromUser:Wt({},this.user)},{},e)},appendMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===Qt[e.toContactId])this.updateContact({id:e.toContactId,unread:"+1",lastSendTime:e.sendTime,lastContent:this.lastContentRender(e)});else{this._addMessage(e,e.toContactId,1);var n={id:e.toContactId,lastContent:this.lastContentRender(e),lastSendTime:e.sendTime};e.toContactId==this.currentContactId?(1==t&&this.messageViewToBottom(),this.CacheDraft.remove(e.toContactId)):n.unread="+1",this.updateContact(n)}},_emitSend:function(e,t,n){var i=this;this.$emit("send",e,function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{status:"succeed"};t(),i.updateMessage(Object.assign(e,n))},n)},_handleSend:function(e){var t=this,n=this._createMessage({content:e});this.appendMessage(n,!0),this._emitSend(n,function(){t.updateContact({id:n.toContactId,lastContent:t.lastContentRender(n),lastSendTime:n.sendTime}),t.CacheDraft.remove(n.toContactId)})},_handleUpload:function(e){var t,n=this,i=["image/gif","image/jpeg","image/png"];t=i.includes(e.type)?{type:"image",content:URL.createObjectURL(e)}:{type:"file",fileSize:e.size,fileName:e.name,content:""};var s=this._createMessage(t);this.appendMessage(s,!0),this._emitSend(s,function(){n.updateContact({id:s.toContactId,lastContent:n.lastContentRender(s),lastSendTime:s.sendTime})},e)},_emitPullMessages:function(e){var t=this;this._changeContactLock=!0,this.$emit("pull-messages",this.currentContact,function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t._addMessage(n,t.currentContactId,0),t.CacheMessageLoaded.set(t.currentContactId,i),1==i&&t.$refs.messages.loaded(),t.updateCurrentMessages(),t._changeContactLock=!1,e(i)},this)},clearCacheContainer:function(e){this.CacheContactContainer.remove(e),this.CacheMenuContainer.remove(e)},_renderWrapper:function(e){var t=this.$createElement;return t("div",{style:{width:en(this.width),height:en(this.height)},ref:"wrapper",class:["lemon-wrapper","lemon-wrapper--theme-".concat(this.theme),{"lemon-wrapper--simple":this.simple},this.drawerVisible&&"lemon-wrapper--drawer-show"]},[e])},_renderMenu:function(){var e=this,t=this.$createElement,n=this._renderMenuItem();return t("div",{class:"lemon-menu",directives:[{name:"show",value:!this.hideMenu}]},[t("lemon-avatar",{directives:[{name:"show",value:!this.hideMenuAvatar}],on:{click:function(t){e.$emit("menu-avatar-click",t)}},class:"lemon-menu__avatar",attrs:{src:this.user.avatar}}),n.top,this.$slots.menu,t("div",{class:"lemon-menu__bottom"},[this.$slots["menu-bottom"],n.bottom])])},_renderMenuAvatar:function(){},_renderMenuItem:function(){var e=this,t=this.$createElement,n=[],i=[];return this.menus.forEach(function(s){var a=s.name,r=s.title,o=s.unread,c=s.render,l=s.click,u=t("div",{class:["lemon-menu__item",{"lemon-menu__item--active":e.activeSidebar==a}],on:{click:function(){ke(l,function(){a&&e.changeMenu(a)})}},attrs:{title:r}},[t("lemon-badge",{attrs:{count:o}},[c(s)])]);!0===s.isBottom?i.push(u):n.push(u)}),{top:n,bottom:i}},_renderSidebarMessage:function(){var e=this;return this._renderSidebar([Ie(this.$scopedSlots["sidebar-message-top"],null,this),this.lastMessages.map(function(t){return e._renderContact({contact:t,timeFormat:e.contactTimeFormat},function(){return e.changeContact(t.id)},e.$scopedSlots["sidebar-message"])})],At,Ie(this.$scopedSlots["sidebar-message-fixedtop"],null,this))},_renderContact:function(e,t,n){var i=this,s=this.$createElement,a=e.contact,r=a.click,o=a.renderContainer,c=a.id,u=function(){ke(r,function(){t(),i._customContainerReady(o,i.CacheContactContainer,c)})};return s("lemon-contact",l()([{class:{"lemon-contact--active":this.currentContactId==e.contact.id},directives:[{name:"lemon-contextmenu",value:this.contactContextmenu,modifiers:{contact:!0}}]},{props:e},{on:{click:u},scopedSlots:{default:n}}]))},_renderSidebarContact:function(){var e,t=this,n=this.$createElement;return this._renderSidebar([Ie(this.$scopedSlots["sidebar-contact-top"],null,this),this.contacts.map(function(i){if(i.index){i.index=i.index.replace(/\[[0-9]*\]/,"");var s=[i.index!==e&&n("p",{class:"lemon-sidebar__label"},[i.index]),t._renderContact({contact:i,simple:!0},function(){t.changeContact(i.id)},t.$scopedSlots["sidebar-contact"])];return e=i.index,s}})],Bt,Ie(this.$scopedSlots["sidebar-contact-fixedtop"],null,this))},_renderSidebar:function(e,t,n){var i=this.$createElement;return i("div",{class:"lemon-sidebar",directives:[{name:"show",value:this.activeSidebar==t}],on:{scroll:this._handleSidebarScroll}},[i("div",{class:"lemon-sidebar__fixed-top"},[n]),i("div",{class:"lemon-sidebar__scroll"},[e])])},_renderDrawer:function(){var e=this.$createElement;return this._menuIsMessages()&&this.currentContactId?e("div",{class:"lemon-drawer",ref:"drawer"},[nn(this.currentContact),Ie(this.$scopedSlots.drawer,"",this.currentContact)]):""},_isContactContainerCache:function(e){return e.startsWith("contact#")},_renderContainer:function(){var e=this,t=this.$createElement,n=[],i="lemon-container",s=this.currentContact,a=!0;for(var r in this.CacheContactContainer.get()){var o=s.id==r&&this.currentIsDefSidebar;a=!o,n.push(t("div",{class:i,directives:[{name:"show",value:o}]},[this.CacheContactContainer.get(r)]))}for(var c in this.CacheMenuContainer.get())n.push(t("div",{class:i,directives:[{name:"show",value:this.activeSidebar==c&&!this.currentIsDefSidebar}]},[this.CacheMenuContainer.get(c)]));return n.push(t("div",{class:i,directives:[{name:"show",value:this._menuIsMessages()&&a&&s.id}]},[t("div",{class:"lemon-container__title"},[Ie(this.$scopedSlots["message-title"],t("div",{class:"lemon-container__displayname"},[s.displayName]),s)]),t("div",{class:"lemon-vessel"},[t("div",{class:"lemon-vessel__left"},[t("lemon-messages",{ref:"messages",attrs:{"loading-text":this.loadingText,"loadend-text":this.loadendText,"hide-time":this.hideMessageTime,"hide-name":this.hideMessageName,"time-format":this.messageTimeFormat,"reverse-user-id":this.user.id,messages:this.currentMessages},on:{"reach-top":this._emitPullMessages}}),t("lemon-editor",{ref:"editor",attrs:{tools:this.editorTools,sendText:this.sendText,sendKey:this.sendKey},on:{send:this._handleSend,upload:this._handleUpload}})]),t("div",{class:"lemon-vessel__right"},[Ie(this.$scopedSlots["message-side"],null,s)])])])),n.push(t("div",{class:i,directives:[{name:"show",value:!s.id&&this.currentIsDefSidebar}]},[this.$slots.cover])),n.push(t("div",{class:i,directives:[{name:"show",value:this._menuIsContacts()&&a&&s.id}]},[Ie(this.$scopedSlots["contact-info"],t("div",{class:"lemon-contact-info"},[t("lemon-avatar",{attrs:{src:s.avatar,size:90}}),t("h4",[s.displayName]),t("lemon-button",{on:{click:function(){A(s.lastContent)&&e.updateContact({id:s.id,lastContent:" "}),e.changeContact(s.id,At)}}},["发送消息"])]),s)])),n},_handleSidebarScroll:function(){ce.hide()},_addContact:function(e,t){var n={0:"unshift",1:"push"}[t];this.contacts[n](e)},_addMessage:function(e,t,n){var i,s={0:"unshift",1:"push"}[n];Array.isArray(e)||(e=[e]),Qt[t]=Qt[t]||[],(i=Qt[t])[s].apply(i,Object(qt["a"])(e))},setLastContentRender:function(e,t){Vt[e]=t},lastContentRender:function(e){return B(Vt[e.type])?Vt[e.type].call(this,e):(console.error("not found '".concat(e.type,"' of the latest message renderer,try to use ‘setLastContentRender()’")),"")},emojiNameToImage:function(e){return e.replace(/\[!(\w+)\]/gi,function(e,t){var n=t;return Zt[n]?'<img emoji-name="'.concat(t,'" src="').concat(Zt[n],'" />'):"[!".concat(t,"]")})},emojiImageToName:function(e){return e.replace(/<img emoji-name=\"([^\"]*?)\" [^>]*>/gi,"[!$1]")},updateCurrentMessages:function(){Qt[this.currentContactId]||(Qt[this.currentContactId]=[]),this.currentMessages=Qt[this.currentContactId]},messageViewToBottom:function(){this.$refs.messages.scrollToBottom()},setDraft:function(e,t){if(A(e)||A(t))return!1;var n=this.findContact(e),i=n.lastContent;if(A(n))return!1;this.CacheDraft.has(e)&&(i=this.CacheDraft.get(e).lastContent),this.CacheDraft.set(e,{editorValue:t,lastContent:i}),this.updateContact({id:e,lastContent:'<span style="color:red;">[草稿]</span><span>'.concat(this.lastContentRender({type:"text",content:t}),"</span>")})},clearDraft:function(e){var t=this.CacheDraft.get(e);if(t){var n=this.findContact(e).lastContent;0===n.indexOf('<span style="color:red;">[草稿]</span>')&&this.updateContact({id:e,lastContent:t.lastContent}),this.CacheDraft.remove(e)}},changeContact:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t,n){var i,s,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}this.changeMenu(n),e.next=6;break;case 4:if(!this._changeContactLock&&this.currentContactId!=t){e.next=6;break}return e.abrupt("return",!1);case 6:if(this.currentContactId&&(i=$e(this.getEditorValue()).trim(),i?(this.setDraft(this.currentContactId,i),this.setEditorValue()):this.clearDraft(this.currentContactId)),this.currentContactId=t,this.currentContactId){e.next=10;break}return e.abrupt("return",!1);case 10:if(this.$emit("change-contact",this.currentContact,this),!B(this.currentContact.renderContainer)&&this.activeSidebar!=Bt){e.next=13;break}return e.abrupt("return");case 13:s=this.CacheDraft.get(t),s&&this.setEditorValue(s.editorValue),this.CacheMessageLoaded.has(t)?this.$refs.messages.loaded():this.$refs.messages.resetLoadState(),Qt[t]?setTimeout(function(){a.updateCurrentMessages(),a.messageViewToBottom()},0):(this.updateCurrentMessages(),this._emitPullMessages(function(e){a.messageViewToBottom()}));case 17:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),removeMessage:function(e){var t=this.findMessage(e);if(!t)return!1;var n=Qt[t.toContactId].findIndex(function(t){var n=t.id;return n==e});return Qt[t.toContactId].splice(n,1),!0},updateMessage:function(e){if(!e.id)return!1;var t=this.findMessage(e.id);return!!t&&(t=Object.assign(t,e,{toContactId:t.toContactId}),!0)},forceUpdateMessage:function(e){if(e){var t=this.$refs.messages.$refs.message;if(t){var n=t.find(function(t){return t.$attrs.message.id==e});n&&n.$forceUpdate()}}else this.$refs.messages.$forceUpdate()},_customContainerReady:function(e,t,n){B(e)&&!t.has(n)&&t.set(n,e.call(this))},changeMenu:function(e){this.$emit("change-menu",e),this.activeSidebar=e},initEmoji:function(e){var t=[];this.$refs.editor.initEmoji(e),e[0].label?e.forEach(function(e){var n;(n=t).push.apply(n,Object(qt["a"])(e.children))}):t=e,t.forEach(function(e){var t=e.name,n=e.src;return Zt[t]=n})},initEditorTools:function(e){this.editorTools=e,this.$refs.editor.initTools(e)},initMenus:function(e){var t=this,n=this.$createElement,i=[{name:At,title:"聊天",unread:0,click:null,render:function(e){return n("i",{class:"lemon-icon-message"})},isBottom:!1}],s=[];if(Array.isArray(e)){var a={messages:0,contacts:1},r=Object.keys(a);s=e.map(function(e){return r.includes(e.name)?Wt({},i[a[e.name]],{},e,{},{renderContainer:null}):(e.renderContainer&&t._customContainerReady(e.renderContainer,t.CacheMenuContainer,e.name),e)})}else s=i;this.menus=s},initContacts:function(e){this.contacts=e,this.sortContacts()},sortContacts:function(){this.contacts.sort(function(e,t){if(e.index)return e.index.localeCompare(t.index)})},appendContact:function(e){return A(e.id)||A(e.displayName)?(console.error("id | displayName cant be empty"),!1):!!this.hasContact(e.id)||(this.contacts.push(Object.assign({id:"",displayName:"",avatar:"",index:"",unread:0,lastSendTime:"",lastContent:""},e)),!0)},removeContact:function(e){var t=this.findContactIndexById(e);return-1!==t&&(this.contacts.splice(t,1),this.CacheDraft.remove(e),this.CacheMessageLoaded.remove(e),!0)},updateContact:function(e){var t=e.id;delete e.id;var n=this.findContactIndexById(t);if(-1!==n){var i=e.unread;F(i)&&(0!==i.indexOf("+")&&0!==i.indexOf("-")||(e.unread=parseInt(i)+parseInt(this.contacts[n].unread))),this.$set(this.contacts,n,Wt({},this.contacts[n],{},e))}},findContactIndexById:function(e){return this.contacts.findIndex(function(t){return t.id==e})},hasContact:function(e){return-1!==this.findContactIndexById(e)},findMessage:function(e){for(var t in Qt){var n=Qt[t].find(function(t){var n=t.id;return n==e});if(n)return n}},findContact:function(e){return this.getContacts().find(function(t){var n=t.id;return n==e})},getContacts:function(){return this.contacts},getCurrentContact:function(){return this.currentContact},getCurrentMessages:function(){return this.currentMessages},setEditorValue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!F(e))return!1;this.$refs.editor.setValue(this.emojiNameToImage(e))},getEditorValue:function(){return this.$refs.editor.getFormatValue()},clearMessages:function(e){return e?(delete Qt[e],this.CacheMessageLoaded.remove(e),this.CacheDraft.remove(e)):(Qt={},this.CacheMessageLoaded.remove(),this.CacheDraft.remove()),!0},getMessages:function(e){return(e?Qt[e]:Qt)||[]},changeDrawer:function(e){this.drawerVisible=!this.drawerVisible,1==this.drawerVisible&&this.openDrawer(e)},openDrawer:function(e){nn=B(e)?e:e.render||new Function;var t=this.$refs.wrapper.clientWidth,n=this.$refs.wrapper.clientHeight,i=e.width||200,s=e.height||n,a=e.offsetX||0,r=e.offsetY||0,o=e.position||"right";F(i)&&(i=t*tn(i)),F(s)&&(s=n*tn(s)),F(a)&&(a=t*tn(a)),F(r)&&(r=n*tn(r)),this.$refs.drawer.style.width="".concat(i,"px"),this.$refs.drawer.style.height="".concat(s,"px");var c=0,l=0,u="";"right"==o?c=t:"rightInside"==o?(c=t-i,u="-15px 0 16px -14px rgba(0,0,0,0.08)"):"center"==o&&(c=t/2-i/2,l=n/2-s/2,u="0 0 20px rgba(0,0,0,0.08)"),c+=a,l+=r+-1,this.$refs.drawer.style.top="".concat(l,"px"),this.$refs.drawer.style.left="".concat(c,"px"),this.$refs.drawer.style.boxShadow=u,this.drawerVisible=!0},closeDrawer:function(){this.drawerVisible=!1}}},an=sn,rn=(n("9b01"),Object(b["a"])(an,Jt,Xt,!1,null,null,null)),on=rn.exports,cn=(n("6a2b"),"1.4.2"),ln=[on,Fe,at,tt,je,ye,ge,X,me,lt,vt,It,Ut,Ft],un=function(e){e.directive("LemonContextmenu",ce),ln.forEach(function(t){e.component(t.name,t)})};"undefined"!==typeof window&&window.Vue&&un(window.Vue);var dn={version:cn,install:un},mn=n("26d5"),hn=n.n(mn),fn=n("5c96"),pn=n.n(fn);n("0fae");i["default"].use(dn),i["default"].config.productionTip=!1,i["default"].prototype.goeasy=hn.a.getInstance({host:"hangzhou.goeasy.io",appkey:"BC-f07b49654a344ba1be2f98eb50913820"}),i["default"].use(pn.a),new i["default"]({render:function(e){return e(E)}}).$mount("#app")},ce40:function(e,t,n){"use strict";var i=n("08dd"),s=n.n(i);s.a},cfab:function(e,t,n){"use strict";var i=n("15cf"),s=n.n(i);s.a},dbdc:function(e,t,n){"use strict";var i=n("7802"),s=n.n(i);s.a},e78c:function(e,t,n){},e86c:function(e,t,n){},ed4b:function(e,t,n){"use strict";var i=n("a215"),s=n.n(i);s.a},fbd1:function(e,t,n){"use strict";var i=n("820e"),s=n.n(i);s.a}});